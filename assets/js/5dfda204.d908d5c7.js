"use strict";(self.webpackChunkcnoe=self.webpackChunkcnoe||[]).push([[4347],{28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(96540);const r={},i=s.createContext(r);function a(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:t},e.children)}},50601:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/backstage-github-app-e35214f17c03afc45063f32d47b84f95.png"},63918:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/argocd-github-app-8d7bddca9308000eca00685a458b84aa.png"},88573:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"reference-implementation/aws/README","title":"AWS Reference Implementation","description":"This project contains an Internal Developer Platform (IDP) reference implementation for AWS. This project can bring up an IDP on EKS with all the tools configured and ready to use in production. It will install addons on an EKS cluster as Argo CD apps using GitOps Bridge App of ApplicationSets pattern. Check out the Getting Started guide for installing this solution on an EKS cluster.","source":"@site/docs/reference-implementation/aws/README.md","sourceDirName":"reference-implementation/aws","slug":"/reference-implementation/aws/","permalink":"/docs/reference-implementation/aws/","draft":false,"unlisted":false,"editUrl":"https://github.com/cnoe-io/reference-implementation-aws/blob/main/README.md","tags":[],"version":"current","frontMatter":{"custom_edit_url":"https://github.com/cnoe-io/reference-implementation-aws/blob/main/README.md"},"sidebar":"tutorialSidebar","previous":{"title":"Set up IDP on Local Machine","permalink":"/docs/reference-implementation/local/idpbuilder"},"next":{"title":"Installation Flow","permalink":"/docs/reference-implementation/aws/docs/installation_flow"}}');var r=n(74848),i=n(28453);const a={custom_edit_url:"https://github.com/cnoe-io/reference-implementation-aws/blob/main/README.md"},o="AWS Reference Implementation",l={},c=[{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Addons",id:"addons",level:2},{value:"Installation Flow Diagram",id:"installation-flow-diagram",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Step 1. \u2699\ufe0f Prepare Environment for Installation",id:"step-1-\ufe0f-prepare-environment-for-installation",level:3},{value:"\ud83d\udce6 Install Binaries",id:"-install-binaries",level:4},{value:"\ud83d\udd10 Configure AWS Credentials",id:"-configure-aws-credentials",level:4},{value:"Step 2. \ud83c\udfe2 Create GitHub Organization",id:"step-2--create-github-organization",level:3},{value:"Step 3. \ud83c\udf74 Fork the Repository",id:"step-3--fork-the-repository",level:3},{value:"Step 4. \ud83d\udcbb Create GitHub Apps",id:"step-4--create-github-apps",level:3},{value:"Step 5. \u2699\ufe0f Configure Reference Implementation",id:"step-5-\ufe0f-configure-reference-implementation",level:4},{value:"Step 6. \ud83d\udd12 Create Secrets in AWS Secret Manager",id:"step-6--create-secrets-in-aws-secret-manager",level:4},{value:"Step 7. \u2638\ufe0f Create EKS Cluster",id:"step-7-\ufe0f-create-eks-cluster",level:3},{value:"Step 8. \ud83d\ude80 Deployment",id:"step-8--deployment",level:3},{value:"\u25b6\ufe0f Start the Installation Process",id:"\ufe0f-start-the-installation-process",level:4},{value:"Step 9. \ud83c\udf10 Accessing the Platform",id:"step-9--accessing-the-platform",level:3},{value:"\ud83d\udcca Monitor Deployment Process",id:"-monitor-deployment-process",level:4},{value:"Cleanup",id:"cleanup",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"aws-reference-implementation",children:"AWS Reference Implementation"})}),"\n",(0,r.jsxs)(t.p,{children:["This project contains an Internal Developer Platform (IDP) reference implementation for AWS. This project can bring up an IDP on EKS with all the tools configured and ready to use in production. It will install addons on an EKS cluster as Argo CD apps using GitOps Bridge App of ApplicationSets pattern. Check out the ",(0,r.jsx)(t.a,{href:"#getting-started",children:"Getting Started"})," guide for installing this solution on an EKS cluster."]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsx)(t.p,{children:"Applications deployed in this repository are a starting point to get environment into production."})}),"\n",(0,r.jsx)(t.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"overview",src:n(89481).A+"",width:"2304",height:"2099"})}),"\n",(0,r.jsx)(t.h2,{id:"addons",children:"Addons"}),"\n",(0,r.jsxs)(t.p,{children:["All the addons are helm charts with static values configured in ",(0,r.jsx)(t.code,{children:"packages/<addon-name>/values.yaml"})," and dynamic values based on Argo CD cluster secret label/annotations values in ",(0,r.jsx)(t.code,{children:"packages/addons/values.yaml"}),"."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Namespace"}),(0,r.jsx)(t.th,{children:"Purpose"}),(0,r.jsx)(t.th,{children:"Chart Version"}),(0,r.jsx)(t.th,{children:"Chart"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Argo CD"}),(0,r.jsx)(t.td,{children:"argocd"}),(0,r.jsx)(t.td,{children:"Installation and management of addon Argo CD application"}),(0,r.jsx)(t.td,{children:"8.0.14"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd",children:"Link"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Argo Workflows"}),(0,r.jsx)(t.td,{children:"argo"}),(0,r.jsx)(t.td,{children:"Workflow tool for continuous integration tasks"}),(0,r.jsx)(t.td,{children:"0.45.18"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/argoproj/argo-helm/tree/main/charts/argo-workflows",children:"Link"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Backstage"}),(0,r.jsx)(t.td,{children:"backstage"}),(0,r.jsx)(t.td,{children:"Self-Service Web UI (Developer Portal) for developers"}),(0,r.jsx)(t.td,{children:"2.6.0"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/backstage/charts/tree/main/charts/backstage",children:"Link"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Cert Manager"}),(0,r.jsx)(t.td,{children:"cert-manager"}),(0,r.jsx)(t.td,{children:"Certificate manager for addons and developer applications using Let's Encrypt"}),(0,r.jsx)(t.td,{children:"1.17.2"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://cert-manager.io/docs/installation/helm/",children:"Link"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Crossplane"}),(0,r.jsx)(t.td,{children:"crossplane-system"}),(0,r.jsx)(t.td,{children:"IaC controller for provisioning infrastructure"}),(0,r.jsx)(t.td,{children:"1.20.0"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/crossplane/crossplane/tree/main/cluster/charts/crossplane",children:"Link"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ACK"}),(0,r.jsx)(t.td,{children:"ack-system"}),(0,r.jsx)(t.td,{children:"IaC controller for provisioning infrastructure"}),(0,r.jsx)(t.td,{children:"TBD"}),(0,r.jsxs)(t.td,{children:["Coming soon check ",(0,r.jsx)(t.a,{href:"https://github.com/cnoe-io/reference-implementation-aws/issues/54",children:"#54"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"External DNS"}),(0,r.jsx)(t.td,{children:"external-dns"}),(0,r.jsx)(t.td,{children:"Domain management using Route 53"}),(0,r.jsx)(t.td,{children:"1.16.1"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/kubernetes-sigs/external-dns/tree/master/charts/external-dns",children:"Link"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"External Secrets"}),(0,r.jsx)(t.td,{children:"external-secrets"}),(0,r.jsx)(t.td,{children:"Secret Management using AWS Secret Manager and AWS Systems Manager Parameter Store"}),(0,r.jsx)(t.td,{children:"Version"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/external-secrets/external-secrets/tree/main/deploy/charts/external-secrets",children:"Link"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Ingress NGINX"}),(0,r.jsx)(t.td,{children:"ingress-nginx"}),(0,r.jsx)(t.td,{children:"Ingress controller for L7 network traffic routing"}),(0,r.jsx)(t.td,{children:"4.7.0"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/kubernetes/ingress-nginx/tree/main/charts/ingress-nginx",children:"Link"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Keycloak"}),(0,r.jsx)(t.td,{children:"keycloak"}),(0,r.jsx)(t.td,{children:"Identity provider for User Authentication"}),(0,r.jsx)(t.td,{children:"24.7.3"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/bitnami/charts/tree/main/bitnami/keycloak",children:"Link"})})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["Check out more details about the ",(0,r.jsx)(t.a,{href:"/docs/reference-implementation/aws/docs/installation_flow",children:"installation flow"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"installation-flow-diagram",children:"Installation Flow Diagram"}),"\n",(0,r.jsx)(t.p,{children:"This diagram illustrates the high-level installation flow for the CNOE AWS Reference Implementation. It shows how the local environment interacts with AWS resources to deploy and configure the platform on an EKS cluster."}),"\n",(0,r.jsx)(t.mermaid,{value:'flowchart TD\n    subgraph "Local Environment"\n        config["config.yaml"]\n        secrets["GitHub App Credentials\n        (private/*.yaml)"]\n        create_secrets["create-config-secrets.sh"]\n        install["install.sh"]\n        helm["helm"]\n    end\n\n    subgraph "AWS"\n        aws_secrets["AWS Secrets Manager\n        - cnoe-ref-impl/config\n        - cnoe-ref-impl/github-app"]\n\n        subgraph "EKS Cluster"\n            eks_argocd["Argo CD"]\n            eso["External Secret Operator"]\n            appset["addons-appset\n            (ApplicationSet)"]\n\n            subgraph "Addons"\n                backstage["Backstage"]\n                keycloak["Keycloak"]\n                crossplane["Crossplane"]\n                cert_manager["Cert Manager"]\n                external_dns["External DNS"]\n                ingress["Ingress NGINX"]\n                argo_workflows["Argo Workflows"]\n            end\n        end\n    end\n\n    config --\x3e create_secrets\n    secrets --\x3e create_secrets\n    create_secrets --\x3e aws_secrets\n\n    config --\x3e install\n    install --\x3e helm\n\n    helm -- "Installs" --\x3e eks_argocd\n    helm -- "Installs" --\x3e eso\n    helm -- "Creates" --\x3e appset\n\n    aws_secrets -- "Provides configuration" --\x3e eso\n\n    appset -- "Creates Argo CD Addon ApplicationSets" --\x3e Addons\n\n    eks_argocd -- "Manages" --\x3e Addons\n    eso -- "Provides secrets to" --\x3e Addons\n\n    classDef aws fill:#FF9900,stroke:#232F3E,color:white;\n    classDef k8s fill:#326CE5,stroke:#254AA5,color:white;\n    classDef tools fill:#4CAF50,stroke:#388E3C,color:white;\n    classDef config fill:#9C27B0,stroke:#7B1FA2,color:white;\n\n    class aws_secrets,EKS aws;\n    class eks_argocd,eso,appset,backstage,keycloak,crossplane,cert_manager,external_dns,ingress,argo_workflows k8s;\n    class helm,install,create_secrets tools;\n    class config,secrets config;'}),"\n",(0,r.jsx)(t.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,r.jsx)(t.h3,{id:"step-1-\ufe0f-prepare-environment-for-installation",children:"Step 1. \u2699\ufe0f Prepare Environment for Installation"}),"\n",(0,r.jsx)(t.h4,{id:"-install-binaries",children:"\ud83d\udce6 Install Binaries"}),"\n",(0,r.jsx)(t.p,{children:"The installation requires the following binaries in the local environment:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:(0,r.jsx)(t.strong,{children:"AWS CLI"})})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:(0,r.jsx)(t.strong,{children:"kubectl"})})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://mikefarah.gitbook.io/yq/v3.x",children:(0,r.jsx)(t.strong,{children:"yq"})})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://helm.sh/docs/intro/install/",children:(0,r.jsx)(t.strong,{children:"helm"})})}),"\n"]}),"\n",(0,r.jsx)(t.h4,{id:"-configure-aws-credentials",children:"\ud83d\udd10 Configure AWS Credentials"}),"\n",(0,r.jsxs)(t.p,{children:["Configure the AWS CLI with credentials of an IAM role which has access to the EKS cluster. Follow the instructions in the ",(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-quickstart.html#getting-started-quickstart-new",children:"AWS documentation"})," to configure the AWS CLI."]}),"\n",(0,r.jsx)(t.p,{children:"If the installation steps are being executed on an EC2 instance, ensure that the EC2 IAM instance role has permissions to access the EKS cluster or the AWS CLI is configured as mentioned above."}),"\n",(0,r.jsx)(t.h3,{id:"step-2--create-github-organization",children:"Step 2. \ud83c\udfe2 Create GitHub Organization"}),"\n",(0,r.jsx)(t.p,{children:"Backstage and Argo CD in this reference implementation are integrated with GitHub. Both Backstage and ArgoCD use Github Apps for authenticating with Github."}),"\n",(0,r.jsxs)(t.p,{children:["Therefore, a GitHub Organization should be created in order to create GitHub Apps for these integrations. Follow the instructions in ",(0,r.jsx)(t.a,{href:"https://docs.github.com/en/organizations/collaborating-with-groups-in-organizations/creating-a-new-organization-from-scratch",children:"GitHub documentation"})," to create new organization or visit ",(0,r.jsx)(t.a,{href:"https://github.com/account/organizations/new",children:"here"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["It is recommended to use a Github Organization instead of a personal github ID as Backstage has certain ",(0,r.jsx)(t.a,{href:"https://backstage.io/docs/integrations/github/github-apps/#caveats",children:"limitations"})," for using personal account Github Apps for authenticating to Github. Also, the Github Organization is ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"FREE"})}),"."]})}),"\n",(0,r.jsx)(t.h3,{id:"step-3--fork-the-repository",children:"Step 3. \ud83c\udf74 Fork the Repository"}),"\n",(0,r.jsxs)(t.p,{children:["Once the organization is created, fork this repository to the new GitHub Organization by following instructions in ",(0,r.jsx)(t.a,{href:"https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/working-with-forks/fork-a-repo",children:"GitHub documentation"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"step-4--create-github-apps",children:"Step 4. \ud83d\udcbb Create GitHub Apps"}),"\n",(0,r.jsxs)(t.p,{children:["There are two ways to create a GitHub App. You can use the Backstage CLI ",(0,r.jsx)(t.code,{children:"npx @backstage/cli create-github-app <github-org>"})," as per instructions in the ",(0,r.jsx)(t.a,{href:"https://backstage.io/docs/integrations/github/github-apps/#using-the-cli-public-github-only",children:"Backstage documentation"}),", or create it manually per these instructions in the ",(0,r.jsx)(t.a,{href:"https://backstage.io/docs/integrations/github/github-apps",children:"GitHub documentation"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"Create the following apps and store them in the corresponding file path."}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"App Name"}),(0,r.jsx)(t.th,{children:"Purpose"}),(0,r.jsx)(t.th,{children:"Required Permissions"}),(0,r.jsx)(t.th,{children:"File Path"}),(0,r.jsx)(t.th,{children:"Expected Content"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Backstage"}),(0,r.jsx)(t.td,{children:"Used for automatically importing Backstage configuration such as Organization information, templates and creating new repositories for developer applications."}),(0,r.jsx)(t.td,{children:"For All Repositories - Read access to members, metadata, and organization administration - Read and write access to administration and code"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"private/backstage-github.yaml"})})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.img,{alt:"backstage-github-app",src:n(50601).A+"",width:"858",height:"330"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Argo CD"}),(0,r.jsx)(t.td,{children:"Used for deploying resources to cluster specified by Argo CD applications."}),(0,r.jsx)(t.td,{children:"For All Repositories - Read access to checks, code, members, and metadata"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"private/argocd-github.yaml"})})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.img,{alt:"argocd-github-app",src:n(63918).A+"",width:"822",height:"272"})})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["The template files for both these Github Apps are available in ",(0,r.jsx)(t.code,{children:"private"})," directory. Copy these template files to above mentioned file path by running following command:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"cp private/argocd-github.yaml.template private/argocd-github.yaml\ncp private/backstage-github.yaml.template private/backstage-github.yaml\n"})}),"\n",(0,r.jsxs)(t.p,{children:["After this, update the values in these files by getting them from files created by ",(0,r.jsx)(t.code,{children:"backstage-cli"})," ",(0,r.jsx)(t.em,{children:"(if used)"})," or get the values from Github page of App Overview."]}),"\n",(0,r.jsxs)(t.p,{children:["Argo CD requires ",(0,r.jsx)(t.code,{children:"url"})," and ",(0,r.jsx)(t.code,{children:"installationId"})," of the GitHub app. The ",(0,r.jsx)(t.code,{children:"url"})," is the GitHub URL of the organization. The ",(0,r.jsx)(t.code,{children:"installationId"})," can be captured by navigating to the app installation page with URL ",(0,r.jsx)(t.code,{children:"https://github.com/organizations/<Organization-name>/settings/installations/<ID>"}),". You can find more information ",(0,r.jsx)(t.a,{href:"https://stackoverflow.com/questions/74462420/where-can-we-find-github-apps-installation-id",children:"on this page"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsx)(t.p,{children:(0,r.jsxs)(t.strong,{children:["If the app is created using the Backstage CLI, it creates files in the current working directory. These files contain credentials. Handle them with care. It is recommended to remove these files after copying the content over to files in the ",(0,r.jsx)(t.code,{children:"private"})," directory"]})})}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["The rest of the installation process assumes the GitHub apps credentials are available in ",(0,r.jsx)(t.code,{children:"private/backstage-github.yaml"})," and ",(0,r.jsx)(t.code,{children:"private/argocd-github.yaml"})]})}),"\n",(0,r.jsx)(t.h4,{id:"step-5-\ufe0f-configure-reference-implementation",children:"Step 5. \u2699\ufe0f Configure Reference Implementation"}),"\n",(0,r.jsxs)(t.p,{children:["The reference implementation uses ",(0,r.jsx)(t.a,{href:"config.yaml",children:"config.yaml"})," file in the repository root directory to configure the installation values. The ",(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"config.yaml"})})," should be updated with appropriate values before proceeding. Refer to the following table and update all the values appropriately. All the values are required."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Parameter"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{children:"Type"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"cluster_name"})}),(0,r.jsxs)(t.td,{children:["Name of the EKS cluster for reference implementation   ",(0,r.jsxs)(t.strong,{children:["(The name should satisfy criteria of a valid ",(0,r.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/names/",children:"kubernetes resource name"}),")"]})]}),(0,r.jsx)(t.td,{children:"string"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"auto_mode"})}),(0,r.jsx)(t.td,{children:'Set to "true" if EKS cluster is Auto Mode, otherwise "false"'}),(0,r.jsx)(t.td,{children:"string"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"repo.url"})}),(0,r.jsx)(t.td,{children:"GitHub URL of the fork in the Github Org"}),(0,r.jsx)(t.td,{children:"string"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"repo.revision"})}),(0,r.jsx)(t.td,{children:"Branch or tag which should be used for Argo CD Apps"}),(0,r.jsx)(t.td,{children:"string"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"repo.basepath"})}),(0,r.jsx)(t.td,{children:"Directory in which the configuration of addons is stored"}),(0,r.jsx)(t.td,{children:"string"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"region"})}),(0,r.jsx)(t.td,{children:"AWS Region of the EKS cluster and config secret"}),(0,r.jsx)(t.td,{children:"string"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"domain"})}),(0,r.jsxs)(t.td,{children:["Base Domain name for exposing services ",(0,r.jsx)(t.strong,{children:"(This should be base domain or sub domain of the Route53 Hosted Zone)"})]}),(0,r.jsx)(t.td,{children:"string"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"route53_hosted_zone_id"})}),(0,r.jsx)(t.td,{children:"Route53 hosted zone ID for configuring external-dns"}),(0,r.jsx)(t.td,{children:"string"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"path_routing"})}),(0,r.jsx)(t.td,{children:'Enable path routing ("true") vs domain-based routing ("false")'}),(0,r.jsx)(t.td,{children:"string"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tags"})}),(0,r.jsx)(t.td,{children:"Arbitrary key-value pairs for AWS resource tagging"}),(0,r.jsx)(t.td,{children:"object"})]})]})]}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsx)(t.p,{children:"If these values are updated after installation, ensure to run the command in the next step to update the values in AWS Secret Manager. Otherwise, the updated values will not reflect in the live installation."})}),"\n",(0,r.jsx)(t.h4,{id:"step-6--create-secrets-in-aws-secret-manager",children:"Step 6. \ud83d\udd12 Create Secrets in AWS Secret Manager"}),"\n",(0,r.jsx)(t.p,{children:"The values required for the installation are stored in AWS Secret Manager in two secrets:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"cnoe-ref-impl/config:"})," Stores values from ",(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"config.yaml"})})," in JSON"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"cnoe-ref-impl/github-app:"})," Stores GitHub App credentials with file name as key and content of the file as value from ",(0,r.jsx)(t.strong,{children:"private"})," directory."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Run the command below to create new secrets or update the existing secrets if they already exist."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"./scripts/create-config-secrets.sh\n"})}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"DO NOT"})," move to next steps without completing all the instructions in this step"]})}),"\n",(0,r.jsx)(t.h3,{id:"step-7-\ufe0f-create-eks-cluster",children:"Step 7. \u2638\ufe0f Create EKS Cluster"}),"\n",(0,r.jsx)(t.p,{children:"The reference implementation can be installed on a new EKS cluster which can be created like this:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"export REPO_ROOT=$(git rev-parse --show-toplevel)\n$REPO_ROOT/scripts/create-cluster.sh\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You will be prompted to select ",(0,r.jsx)(t.code,{children:"eksctl"})," or ",(0,r.jsx)(t.code,{children:"terraform"})]}),"\n",(0,r.jsx)(t.p,{children:"For more details on each type of tools check the corresponding guides:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"eksctl"}),": Follow the ",(0,r.jsx)(t.a,{href:"cluster/eksctl",children:"instructions"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"terraform"}),": Follow the ",(0,r.jsx)(t.a,{href:"cluster/terraform/",children:"instructions"})]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"This will create all the prerequisite AWS Resources required for the reference implementation, which includes:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"EKS cluster with Auto Mode or Without Auto Mode (Managed Node Group with 4 nodes)"}),"\n",(0,r.jsx)(t.li,{children:"Pod Identity Associations for following Addons:"}),"\n"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Namespace"}),(0,r.jsx)(t.th,{children:"Service Account Name"}),(0,r.jsx)(t.th,{children:"Permissions"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Crossplane"}),(0,r.jsx)(t.td,{children:"crossplane-system"}),(0,r.jsx)(t.td,{children:"provider-aws"}),(0,r.jsxs)(t.td,{children:["Admin Permissions but with ",(0,r.jsx)(t.a,{href:"cluster/iam-policies/crossplane-permissions-boundry.json",children:"permission boundary"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"External Secrets"}),(0,r.jsx)(t.td,{children:"external-secrets"}),(0,r.jsx)(t.td,{children:"external-secrets"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://external-secrets.io/latest/provider/aws-secrets-manager/#iam-policy",children:"Permissions"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"External DNS"}),(0,r.jsx)(t.td,{children:"external-dns"}),(0,r.jsx)(t.td,{children:"external-dns"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://kubernetes-sigs.github.io/external-dns/latest/docs/tutorials/aws/#iam-policy",children:"Permissions"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS Load Balancer Controller (When not using Auto Mode)"}),(0,r.jsx)(t.td,{children:"kube-system"}),(0,r.jsx)(t.td,{children:"aws-load-balancer-controller"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/kubernetes-sigs/aws-load-balancer-controller/blob/main/docs/install/iam_policy.json",children:"Permissions"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS EBS CSI Controller (When not using Auto Mode)"}),(0,r.jsx)(t.td,{children:"kube-system"}),(0,r.jsx)(t.td,{children:"ebs-csi-controller-sa"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AmazonEBSCSIDriverPolicy.html",children:"Permissions"})})]})]})]}),"\n",(0,r.jsxs)(t.admonition,{type:"note",children:[(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Using Existing EKS Cluster"})}),(0,r.jsx)(t.p,{children:"The reference implementation can be installed on an existing EKS Cluster only if the above prerequisites are completed."})]}),"\n",(0,r.jsx)(t.h3,{id:"step-8--deployment",children:"Step 8. \ud83d\ude80 Deployment"}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsx)(t.p,{children:"Before moving forward, ensure that the kubectl context is set to the EKS cluster and the configured AWS IAM role has access to the cluster."})}),"\n",(0,r.jsx)(t.h4,{id:"\ufe0f-start-the-installation-process",children:"\u25b6\ufe0f Start the Installation Process"}),"\n",(0,r.jsxs)(t.p,{children:["All the addons are installed as Argo CD apps. At the start of the installation, Argo CD and External Secret Operator are installed on the EKS cluster as a helm chart. Once Argo CD on EKS is up, other addons are installed through it and finally the Argo CD on EKS also manages itself and External Secret Operator. Check out more details about the ",(0,r.jsx)(t.a,{href:"/docs/reference-implementation/aws/docs/installation_flow",children:"installation flow"}),". Run the following command to start the installation."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"scripts/install.sh\n"})}),"\n",(0,r.jsx)(t.h3,{id:"step-9--accessing-the-platform",children:"Step 9. \ud83c\udf10 Accessing the Platform"}),"\n",(0,r.jsxs)(t.p,{children:["The addons with Web UI are exposed using the base domain configured in ",(0,r.jsx)(t.a,{href:"#%EF%B8%8F-configure-reference-implementation",children:"Step 5"}),". The URLs can be retrieved by running the following command:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"scripts/get-urls.sh\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The URL depends on the setting for ",(0,r.jsx)(t.code,{children:"path_routing"}),". Refer to following table for URLs:"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"App Name"}),(0,r.jsx)(t.th,{children:"URL (w/ Path Routing)"}),(0,r.jsx)(t.th,{children:"URL (w/o Path Routing)"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Backstage"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"https://[domain]"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"https://backstage.[domain]"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Argo CD"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"https://[domain]/argocd"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"https://argocd.[domain]"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Argo Workflows"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"https://[domain]/argo-workflows"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"https://argo-workflows.[domain]"})})]})]})]}),"\n",(0,r.jsx)(t.h4,{id:"-monitor-deployment-process",children:"\ud83d\udcca Monitor Deployment Process"}),"\n",(0,r.jsx)(t.p,{children:"The installation script will continue to run until all the Argo CD apps for addons are healthy. To monitor the process, use the instructions below to access the instance of Argo CD running on EKS."}),"\n",(0,r.jsx)(t.p,{children:"Check if the kubectl context is set to the EKS cluster and it can access the EKS cluster."}),"\n",(0,r.jsxs)(t.p,{children:["You can use ",(0,r.jsx)(t.code,{children:"kubectl"})," to check the status of the Argo CD applications"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"kubectl get applications -n argocd --watch\n"})}),"\n",(0,r.jsx)(t.p,{children:"Get the credentials for Argo CD and start a port-forward with this command:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"kubectl get secrets -n argocd argocd-initial-admin-secret -oyaml | yq '.data.password' | base64 -d && echo\nkubectl port-forward -n argocd svc/argocd-server 8080:80\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Depending upon the configuration, Argo CD will be accessible at ",(0,r.jsx)(t.a,{href:"http://localhost:8080",children:"http://localhost:8080"})," or ",(0,r.jsx)(t.a,{href:"http://localhost:8080/argocd",children:"http://localhost:8080/argocd"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["All the addons are configured with Keycloak SSO ",(0,r.jsx)(t.code,{children:"user1"})," and the user password for it can be retrieved using the following command:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"kubectl get secret -n keycloak keycloak-config -o jsonpath='{.data.USER1_PASSWORD}' | base64 -d && echo\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Once all the Argo CD apps on the EKS cluster are reporting healthy status, try out the ",(0,r.jsx)(t.a,{href:"examples/",children:"examples"})," to create a new application through Backstage.\nFor troubleshooting, refer to the ",(0,r.jsx)(t.a,{href:"/docs/reference-implementation/aws/docs/troubleshooting",children:"troubleshooting guide"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"cleanup",children:"Cleanup"}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsx)(t.p,{children:"Before proceeding with the cleanup, ensure any Kubernetes resources created outside of the installation process such as Argo CD Apps, deployments, volumes etc. are deleted."})}),"\n",(0,r.jsx)(t.p,{children:"Run the following command to remove all the addons created by this installation:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"scripts/uninstall.sh\n"})}),"\n",(0,r.jsx)(t.p,{children:"This script will only remove resources other than CRDs from the EKS cluster so that the same cluster can be used for re-installation which is useful during development. To remove CRDs, use the following command:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"scripts/cleanup-crds.sh\n"})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},89481:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/overview-d1888b26df7b7ed750ac915f7c85159c.png"}}]);