"use strict";(self.webpackChunkcnoe=self.webpackChunkcnoe||[]).push([[3671],{5753:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/demo2-entity-5f2c59d6c7711dfb76b1909ca249f4d0.png"},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var s=n(96540);const a={},o=s.createContext(a);function i(e){const t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(o.Provider,{value:t},e.children)}},42694:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/basic-template-flow-007917e51d03345a93a9dc4a82cc0f2b.png"},49239:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/backstage-templates-spark-b8543351cda19c6d2f6222047588a7bb.png"},51891:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/demo-entity-f619f94698926ee09dc5f5439c35e816.png"},82131:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"reference-implementation/local/index","title":"Set up IDP Reference Implementation on Local Machine","description":"Set up IDP Reference Implementation on Local Machine","source":"@site/docs/reference-implementation/local/index.md","sourceDirName":"reference-implementation/local","slug":"/reference-implementation/local/","permalink":"/docs/reference-implementation/local/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Set up IDP Reference Implementation on Local Machine","description":"Set up IDP Reference Implementation on Local Machine","index":1},"sidebar":"tutorialSidebar","previous":{"title":"Technology Radars","permalink":"/docs/overview/radar/"},"next":{"title":"Access Management","permalink":"/docs/reference-implementation/local/access-management"}}');var a=n(74848),o=n(28453);const i={sidebar_position:2,title:"Set up IDP Reference Implementation on Local Machine",description:"Set up IDP Reference Implementation on Local Machine",index:1},r=void 0,c={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"What was installed?",id:"what-was-installed",level:3},{value:"Concepts",id:"concepts",level:3},{value:"Access Management",id:"access-management",level:4},{value:"Infrastructure Control Plane",id:"infrastructure-control-plane",level:4},{value:"Secrets Management",id:"secrets-management",level:4},{value:"Accessing UIs",id:"accessing-uis",level:3},{value:"Logging into Backstage",id:"logging-into-backstage",level:3},{value:"If you want to create a new user or change existing users:",id:"if-you-want-to-create-a-new-user-or-change-existing-users",level:4},{value:"Usecases",id:"usecases",level:2},{value:"Basic Deployment",id:"basic-deployment",level:3},{value:"What just happened?",id:"what-just-happened",level:4},{value:"Argo Workflows and Spark Operator",id:"argo-workflows-and-spark-operator",level:3},{value:"Application with cloud resources.",id:"application-with-cloud-resources",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"This example creates a local version of the CNOE reference implementation."}),"\n",(0,a.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsx)(t.p,{children:"Ensure you have the following tools installed on your computer."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"Required"})}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Complete the ",(0,a.jsx)(t.a,{href:"/docs/idpbuilder/installation",children:"idpbuilder installation"})]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://github.com/cnoe-io/idpbuilder/releases/latest",children:"idpbuilder"}),": version ",(0,a.jsx)(t.code,{children:"0.3.0"})," or later."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/tools/#kubectl",children:"kubectl"}),": version ",(0,a.jsx)(t.code,{children:"1.27"})," or later"]}),"\n",(0,a.jsxs)(t.li,{children:["Your computer should have at least 6 GB RAM allocated to Docker. If you are on Docker Desktop, see ",(0,a.jsx)(t.a,{href:"https://docs.docker.com/desktop/settings/mac/",children:"this guide"}),"."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"Optional"})}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"AWS credentials: Access Key and secret Key. If you want to create AWS resources in one of examples below."}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["If you'd like to run this in your web browser through Codespaces, please follow ",(0,a.jsx)(t.a,{href:"https://github.com/cnoe-io/stacks/blob/main/ref-implementation/codespaces.md",children:"the instructions here"})," to install instead."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"This example assumes that you run the reference implementation with the default port configguration of 8443 for the idpBuilder.\nIf you happen to configure a different host or port for the idpBuilder, the manifests in the reference example need to be updated\nand be configured with the new host and port."}),"\n"]}),"\n"]})}),"\n",(0,a.jsx)(t.p,{children:"Run the following command from the root of this repository."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"$ idpbuilder create --use-path-routing \\\n  --package https://github.com/cnoe-io/stacks//ref-implementation\n"})}),"\n",(0,a.jsxs)(t.p,{children:["This will take ~6 minutes for everything to come up. To track the progress, you can go to the ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/argocd/applications",children:"ArgoCD UI"}),"."]}),"\n",(0,a.jsx)(t.h3,{id:"what-was-installed",children:"What was installed?"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Argo Workflows"})," to enable workflow orchestrations."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Backstage"})," as the UI for software catalog and templating. Source is available ",(0,a.jsx)(t.a,{href:"https://github.com/cnoe-io/backstage-app",children:"here"}),". Also check ",(0,a.jsx)(t.a,{href:"./idp-ref/access-management#backstage-and-kubernetes-authentication",children:"server side authentication"})," for Backstage users access."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Crossplane"}),", AWS providers, and basic compositions for deploying cloud related resources (needs your credentials for this to work)"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"External Secrets"})," to generate secrets and coordinate secrets between applications."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Keycloak"})," as the identity provider for applications. Also check ",(0,a.jsx)(t.a,{href:"./idp-ref/access-management#keycloak",children:"keycloak authentication"})," for Backstage users access."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Spark Operator"})," to demonstrate an example Spark workload through Backstage."]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["If you don't want to install a package above, you can remove the ArgoCD Application file corresponding to the package you want to remove.\nFor example, if you want to remove Spark Operator, you can delete ",(0,a.jsx)(t.a,{href:"https://github.com/cnoe-io/stacks/blob/main/ref-implementation/spark-operator.yaml",children:"this file"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"# remove spark operator from this installation.\n$ rm examples/ref-implementation/spark-operator.yaml\n"})}),"\n",(0,a.jsx)(t.p,{children:"The only package that cannot be removed this way is Keycloak because other packages rely on it."}),"\n",(0,a.jsx)(t.h3,{id:"concepts",children:"Concepts"}),"\n",(0,a.jsx)(t.h4,{id:"access-management",children:"Access Management"}),"\n",(0,a.jsxs)(t.p,{children:["This ",(0,a.jsx)(t.a,{href:"idp-ref/access-management",children:"section"})," details how access management is implemented using Keycloak as the identity provider and also explaining the current server-side authentication pattern in Backstage where all users share the same credential level."]}),"\n",(0,a.jsx)(t.h4,{id:"infrastructure-control-plane",children:"Infrastructure Control Plane"}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.a,{href:"idp-ref/control-plane",children:"infrastructure control plane"})," utilizes Crossplane for AWS resource management and ArgoCD for manifest synchronization, combining GitOps and Crossplane compositions to provision and govern external resources through Kubernetes APIs. This approach allows for the enforcement of security and configuration requirements, such as tagging and encryption for S3 buckets, while also enabling developer self-service through YAML files in a Git repository."]}),"\n",(0,a.jsx)(t.h4,{id:"secrets-management",children:"Secrets Management"}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.a,{href:"idp-ref/secrets",children:"External Secrets Operator"})," is a Kubernetes Operator that retrieves secrets from external secret stores (like Vault and AWS Secrets Manager) and creates corresponding Kubernetes secrets within the cluster. The operator can manage various types of secrets including TLS certificates, with the ability to sync them between external stores and the cluster, while also providing features like automatic backup during uninstallation to avoid hitting rate limits with services like Let's Encrypt."]}),"\n",(0,a.jsx)(t.h3,{id:"accessing-uis",children:"Accessing UIs"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Argo CD: ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/argocd",children:"https://cnoe.localtest.me:8443/argocd"})]}),"\n",(0,a.jsxs)(t.li,{children:["Argo Workflows: ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/argo-workflows",children:"https://cnoe.localtest.me:8443/argo-workflows"})]}),"\n",(0,a.jsxs)(t.li,{children:["Backstage: ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/",children:"https://cnoe.localtest.me:8443/"})]}),"\n",(0,a.jsxs)(t.li,{children:["Gitea: ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/gitea",children:"https://cnoe.localtest.me:8443/gitea"})]}),"\n",(0,a.jsxs)(t.li,{children:["Keycloak: ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/keycloak/admin/master/console/",children:"https://cnoe.localtest.me:8443/keycloak/admin/master/console/"})]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"logging-into-backstage",children:"Logging into Backstage"}),"\n",(0,a.jsxs)(t.p,{children:["Once applications are ready, go to the ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443",children:"backstage URL"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"Click on the Sign-In button, you will be asked to log into the Keycloak instance. There are two users set up in this\nconfiguration, and their password can be retrieved with the following command:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"$ idpbuilder get secrets\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Use the username ",(0,a.jsx)(t.strong,{children:(0,a.jsx)(t.code,{children:"user1"})})," and the password value given by ",(0,a.jsx)(t.code,{children:"USER_PASSWORD"})," field to login to the backstage instance.\n",(0,a.jsx)(t.code,{children:"user1"})," is an admin user who has access to everything in the cluster, while ",(0,a.jsx)(t.code,{children:"user2"})," is a regular user with limited access.\nBoth users use the same password retrieved above."]}),"\n",(0,a.jsx)(t.h4,{id:"if-you-want-to-create-a-new-user-or-change-existing-users",children:"If you want to create a new user or change existing users:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Go to the ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/keycloak/admin/master/console/",children:"Keycloak UI"}),".\nLogin with the username ",(0,a.jsx)(t.code,{children:"cnoe-admin"}),". Password is the ",(0,a.jsx)(t.code,{children:"KEYCLOAK_ADMIN_PASSWORD"})," field from the command above."]}),"\n",(0,a.jsxs)(t.li,{children:["Select ",(0,a.jsx)(t.code,{children:"cnoe"})," from the realms drop down menu."]}),"\n",(0,a.jsx)(t.li,{children:"Select users tab."}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"usecases",children:"Usecases"}),"\n",(0,a.jsx)(t.p,{children:"For the demonstration, we will walk through few example usecases."}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"In the below examples, we have used the pattern of creating a new repository for every app, then having ArgoCD deploy it.\nThis is done for convenience and demonstration purposes only. There are alternative actions that you can use.\nFor example, you can create a PR to an existing repository, create a repository but not deploy them yet, etc."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"If Backstage's pipelining and templating mechanisms is too simple, you can use more advanced workflow engines like Tekton or Argo Workflows.\nYou can invoke them in Backstage templates, then track progress similar to how it was described above."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"basic-deployment",children:"Basic Deployment"}),"\n",(0,a.jsx)(t.p,{children:"Let's start by deploying a simple application to the cluster through Backstage."}),"\n",(0,a.jsxs)(t.p,{children:["Click on the ",(0,a.jsx)(t.code,{children:"Create..."})," button on the left, then select the ",(0,a.jsx)(t.code,{children:"Create a Basic Deployment"})," template."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"img.png",src:n(87467).A+"",width:"1144",height:"821"})}),"\n",(0,a.jsxs)(t.p,{children:["In the next screen, type ",(0,a.jsx)(t.code,{children:"demo"})," for the name field, then click Review, then Create.\nOnce steps run, click the Open In Catalog button to go to the entity page."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"img.png",src:n(42694).A+"",width:"1076",height:"415"})}),"\n",(0,a.jsx)(t.p,{children:"In the demo entity page, you will notice a ArgoCD overview card associated with this entity.\nYou can click on the ArgoCD Application name to see more details."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"img.png",src:n(51891).A+"",width:"1127",height:"360"})}),"\n",(0,a.jsx)(t.h4,{id:"what-just-happened",children:"What just happened?"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Backstage created ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/gitea/giteaAdmin/demo",children:"a git repository"}),", then pushed templated contents to it."]}),"\n",(0,a.jsxs)(t.li,{children:["Backstage created ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/argocd/applications/argocd/demo?",children:"an ArgoCD Application"})," and pointed it to the git repository."]}),"\n",(0,a.jsxs)(t.li,{children:["Backstage registered the application as ",(0,a.jsx)(t.a,{href:"https://cnoe.localtest.me:8443/gitea/giteaAdmin/demo/src/branch/main/catalog-info.yaml",children:"a component"})," in Backstage."]}),"\n",(0,a.jsx)(t.li,{children:"ArgoCD deployed the manifests stored in the repo to the cluster."}),"\n",(0,a.jsx)(t.li,{children:"Backstage retrieved application health from ArgoCD API, then displayed it."}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"image.png",src:n(95920).A+"",width:"672",height:"291"})}),"\n",(0,a.jsx)(t.h3,{id:"argo-workflows-and-spark-operator",children:"Argo Workflows and Spark Operator"}),"\n",(0,a.jsx)(t.p,{children:"In this example, we will deploy a simple Apache Spark job through Argo Workflows."}),"\n",(0,a.jsxs)(t.p,{children:["Click on the ",(0,a.jsx)(t.code,{children:"Create..."})," button on the left, then select the ",(0,a.jsx)(t.code,{children:"Basic Argo Workflow with a Spark Job"})," template."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"img.png",src:n(49239).A+"",width:"1144",height:"821"})}),"\n",(0,a.jsxs)(t.p,{children:["Type ",(0,a.jsx)(t.code,{children:"demo2"})," for the name field, then click create. You will notice that the Backstage templating steps are very similar to the basic example above.\nClick on the Open In Catalog button to go to the entity page."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"img.png",src:n(5753).A+"",width:"1271",height:"847"})}),"\n",(0,a.jsx)(t.p,{children:"Deployment processes are the same as the first example. Instead of deploying a pod, we deployed a workflow to create a Spark job."}),"\n",(0,a.jsx)(t.p,{children:"In the entity page, there is a card for Argo Workflows, and it should say running or succeeded.\nYou can click the name in the card to go to the Argo Workflows UI to view more details about this workflow run.\nWhen prompted to log in, click the login button under single sign on. Argo Workflows is configured to use SSO with Keycloak allowing you to login with the same credentials as Backstage login."}),"\n",(0,a.jsx)(t.p,{children:"Note that Argo Workflows are not usually deployed this way. This is just an example to show you how you can integrate workflows, backstage, and spark."}),"\n",(0,a.jsx)(t.p,{children:"Back in the entity page, you can view more details about Spark jobs by navigating to the Spark tab."}),"\n",(0,a.jsx)(t.h3,{id:"application-with-cloud-resources",children:"Application with cloud resources."}),"\n",(0,a.jsx)(t.p,{children:"Similar to the above, we can deploy an application with cloud resources using Backstage templates.\nIn this example, we will create an application with a S3 Bucket."}),"\n",(0,a.jsxs)(t.p,{children:["Add the Crossplane integration as discussed ",(0,a.jsx)(t.a,{href:"https://github.com/cnoe-io/stacks/blob/main/crossplane-integrations/README.md",children:"here"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Choose a template named ",(0,a.jsx)(t.code,{children:"App with S3 bucket"}),", type ",(0,a.jsx)(t.code,{children:"demo3"})," as the name, then choose a region to create this bucket in."]}),"\n",(0,a.jsx)(t.p,{children:"Once you click the create button, you will have a very similar setup as the basic example.\nThe only difference is we now have a resource for a S3 Bucket which is managed by Crossplane."}),"\n",(0,a.jsxs)(t.p,{children:["Note that Bucket is ",(0,a.jsx)(t.strong,{children:"not"})," created because Crossplane doesn't have necessary credentials to do so.\nIf you'd like it to actually create a bucket, update ",(0,a.jsx)(t.a,{href:"https://github.com/cnoe-io/stacks/blob/main/crossplane-integrations/crossplane-providers/provider-secret.yaml",children:"the credentials secret file"}),", then run ",(0,a.jsx)(t.code,{children:"idpbuilder create --package examples/ref-implementation"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"In this example, we used Crossplane to provision resources, but you can use other cloud resource management tools such as Terraform instead.\nRegardless of your tool choice, concepts are the same. We use Backstage as the templating mechanism and UI for users, then use Kubernetes API with GitOps to deploy resources."})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},87467:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/backstage-templates-0ef5bcdba970e10a42993876c336ad0d.png"},95920:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/basic-deployment-ee4ea7f4daaffe283d64a6ede6ff146e.png"}}]);