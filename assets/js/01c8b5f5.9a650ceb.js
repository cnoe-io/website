"use strict";(self.webpackChunkcnoe=self.webpackChunkcnoe||[]).push([[1172],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(n),m=i,h=d["".concat(p,".").concat(m)]||d[m]||u[m]||r;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[d]="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2139:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=n(7462),i=(n(7294),n(3905));const r={sidebar_position:1,description:"Set up IDP on Local Machine",title:"Set up IDP on Local Machine",index:1},o=void 0,l={unversionedId:"reference-implementation/idpbuilder/idpbuilder",id:"reference-implementation/idpbuilder/idpbuilder",title:"Set up IDP on Local Machine",description:"Set up IDP on Local Machine",source:"@site/docs/reference-implementation/idpbuilder/idpbuilder.md",sourceDirName:"reference-implementation/idpbuilder",slug:"/reference-implementation/idpbuilder/",permalink:"/docs/reference-implementation/idpbuilder/",draft:!1,editUrl:"https://github.com/cnoe-io/website/tree/main/docs/reference-implementation/idpbuilder/idpbuilder.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,description:"Set up IDP on Local Machine",title:"Set up IDP on Local Machine",index:1},sidebar:"tutorialSidebar",previous:{title:"Technology Radars",permalink:"/docs/intro/radar/"},next:{title:"Using the idpBuilder",permalink:"/docs/reference-implementation/idpbuilder/usage"}},p={},s=[{value:"About",id:"about",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Running ipdbuilder in local machine",id:"running-ipdbuilder-in-local-machine",level:2},{value:"Running ipdbuilder in Codespaces",id:"running-ipdbuilder-in-codespaces",level:2},{value:"Codespaces tips and tricks",id:"codespaces-tips-and-tricks",level:3},{value:"Example mirroring Alpine image",id:"example-mirroring-alpine-image",level:4}],c={toc:s};function d(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"about"},"About"),(0,i.kt)("admonition",{title:"GitHub Repo",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("a",{parentName:"p",href:"https://github.com/cnoe-io/idpbuilder"},"cnoe-io/idpbuilder"))),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"idpBuilder is a powerful tool that enables you to easily spin up a complete internal developer platform (IDP) on your local machine. "),(0,i.kt)("p",null,"Go to ",(0,i.kt)("a",{parentName:"p",href:"/docs/intro/idpbuilder"},"idpbuilder Overview page")," to get more details on the concepts."),(0,i.kt)("h2",{id:"running-ipdbuilder-in-local-machine"},"Running ipdbuilder in local machine"),(0,i.kt)("p",null,"A container engine is needed locally. "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.docker.com/get-started/"},"Docker desktop")," is supported. "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://podman-desktop.io/"},"Podman desktop")," is not supported however idpbuilder can create a cluster using ",(0,i.kt)("a",{parentName:"li",href:"https://docs.podman.io/en/latest/markdown/podman-machine-set.1.html#rootful"},"rootful"),". You need tp set the ",(0,i.kt)("inlineCode",{parentName:"li"},"DOCKER_HOST")," env var property using ",(0,i.kt)("inlineCode",{parentName:"li"},"podman")," to let idpbuilder to talk with the engine (e.g  ",(0,i.kt)("inlineCode",{parentName:"li"},'export DOCKER_HOST="unix:///var/run/docker.sock"'),")")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Option 1: Using Bash Script")),(0,i.kt)("p",null,"You can execute the following bash script to get started with a running version of the idpBuilder (inspect the script first if you have concerns):"),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre"},"curl -fsSL https://raw.githubusercontent.com/cnoe-io/idpbuilder/main/hack/install.sh | bash\n"))),(0,i.kt)("p",null,"verify a successful installation by running the following command and inspecting the output for the right version:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"idpbuilder version\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Option 2: Manual installation")),(0,i.kt)("p",null,"You can run the following commands for a manual installation:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"version=$(curl -Ls -o /dev/null -w %{url_effective} https://github.com/cnoe-io/idpbuilder/releases/latest)\nversion=${version##*/}\ncurl -L -o ./idpbuilder.tar.gz \"https://github.com/cnoe-io/idpbuilder/releases/download/${version}/idpbuilder-$(uname | awk '{print tolower($0)}')-$(uname -m | sed 's/x86_64/amd64/').tar.gz\"\ntar xzf idpbuilder.tar.gz\n\n./idpbuilder version\n# example output\n# idpbuilder 0.4.1 go1.21.5 linux/amd64\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Option 3: Release page binary")),(0,i.kt)("p",null,"The easiest way to get started is to grab the idpbuilder binary for your platform and run it. You can visit our nightly releases page to download the version for your system, or run the following commands:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'arch=$(if [[ "$(uname -m)" == "x86_64" ]]; then echo "amd64"; else uname -m; fi)\nos=$(uname -s | tr \'[:upper:]\' \'[:lower:]\')\n\nidpbuilder_latest_tag=$(curl --silent "https://api.github.com/repos/cnoe-io/idpbuilder/releases/latest" | grep \'"tag_name":\' | sed -E \'s/.*"([^"]+)".*/\\1/\')\ncurl -LO  https://github.com/cnoe-io/idpbuilder/releases/download/$idpbuilder_latest_tag/idpbuilder-$os-$arch.tar.gz\ntar xvzf idpbuilder-$os-$arch.tar.gz\n')),(0,i.kt)("h2",{id:"running-ipdbuilder-in-codespaces"},"Running ipdbuilder in Codespaces"),(0,i.kt)("p",null,"You can run idpbuilder in ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/features/codespaces"},"Codespaces"),"."),(0,i.kt)("p",null,"Create a Codespaces instance. ",(0,i.kt)("img",{alt:"img",src:n(7803).Z,width:"993",height:"554"})),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Wait for it to be ready. It may take several minutes.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Get the latest release of idpbuilder:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"}," version=$(curl -Ls -o /dev/null -w %{url_effective} https://github.com/cnoe-io/idpbuilder/releases/latest)\n version=${version##*/}\n curl -L -o ./idpbuilder.tar.gz \"https://github.com/cnoe-io/idpbuilder/releases/download/${version}/idpbuilder-$(uname | awk '{print tolower($0)}')-$(uname -m | sed 's/x86_64/amd64/').tar.gz\"\n tar xzf idpbuilder.tar.gz\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Run idpbuilder:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"}," idpbuilder create --protocol http  \\\n --host ${CODESPACE_NAME}-8080.${GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN} \\\n --port 8080 --use-path-routing\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Because Codespaces gives a single externally routable host name for an instance, idpbuilder must deploy with path based routing.\nThis means ArgoCD and Gitea UIs are given with the following commands."),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"ArgoCD: ",(0,i.kt)("inlineCode",{parentName:"li"},"echo https://${CODESPACE_NAME}-8080.${GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN}/argocd")),(0,i.kt)("li",{parentName:"ul"},"Gitea: ",(0,i.kt)("inlineCode",{parentName:"li"},"echo https://${CODESPACE_NAME}-8080.${GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN}/gitea"))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Note that not all examples work with path based routing.")," "))),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Codespaces tips and tricks"),(0,i.kt)("h3",{id:"codespaces-tips-and-tricks"},"Codespaces tips and tricks"),(0,i.kt)("p",null," By default all port forwarding in a Codespace environment is private which means that you will not be able to access the OCI registry directly from your local machine's CLI."),(0,i.kt)("p",null,"You can however use the github CLI to port-forward a port on your local machine to the codespace which is running the OCI registry and listening on port 8443."),(0,i.kt)("p",null,"To do this, make sure you have the latest github cli installed. Instructions here: ","[https://github.com/cli/cli#installation]"," (",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cli/cli#installation"},"https://github.com/cli/cli#installation"),")"),(0,i.kt)("p",null,"Next you will need to login to github and give your CLI access to the codespace:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ gh auth login -h github.com -s codespace\n")),(0,i.kt)("p",null,"Follow the prompts to perform the auth via your local machine's browser and make sure to choose the codespace you are running idpbuilder in."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ gh auth login -h github.com -s codespace\n! First copy your one-time code: 0076-1071\nPress Enter to open https://github.com/login/device in your browser... \nOpening in existing browser session.\n\u2713 Authentication complete.\n")),(0,i.kt)("p",null,"List the ports on your codespace:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ gh codespace ports\n? Choose codespace: cnoe-io/idpbuilder [main*]: expert chainsaw\nLABEL  PORT   VISIBILITY  BROWSE URL                                                 \n       8443   private     https://expert-chainsaw-7vjwj6qqgcprjp-8443.app.github.dev\n       37065  private     https://expert-chainsaw-7vjwj6qqgcprjp-37065.app.github.dev\n")),(0,i.kt)("p",null,"Then perform the port-forward. Make sure to use the same port that the codespace has listed in it's port column. Likely this is 8443 which is the default at the time of this writing."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ gh codespace ports forward 8443:8443 -c expert-chainsaw-7vjwj6qqgcprjp\n")),(0,i.kt)("p",null,"If you see a message like the following then you may already have another service on your local machine that is listening on 8443. Make sure to shut it down. (Maybe you were running idpbuilder locally as well?)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"failed to listen to local port over tcp: listen tcp :8443: bind: address already in use\n")),(0,i.kt)("p",null,"Once you have setup the port-forward you will see the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ gh codespace ports forward 8443:8443 -c expert-chainsaw-7vjwj6qqgcprjp\nForwarding ports: remote 8443 <=> local 8443\n")),(0,i.kt)("p",null,"You can now connect directly to the registry hosted on idpbuilder in your codespace environment."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker login cnoe.localtest.me:8443/gitea                            \nAuthenticating with existing credentials...\nStored credentials invalid or expired\nUsername (giteaAdmin): giteaadmin\nPassword: \nWARNING! Your password will be stored unencrypted in /home/sanforj/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credential-stores\n\nLogin Succeeded\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"IMPORTANT!")," As you may have noticed, you must use ",(0,i.kt)("inlineCode",{parentName:"p"},"cnoe.localtest.me:8443")," (or whatever port number was listed) as the registry name."),(0,i.kt)("p",null,"This will allow for compatibility with the oci clients that are working in the codespace as well as those that are running on the idpbuilder kubernetes cluster.\nAs long as you tag your images and push them to ",(0,i.kt)("inlineCode",{parentName:"p"},"cnoe.localtest.me:8443/gitea/giteaadmin/imagename:tag")," they will be able to be referenced on your local machine, on the cli within the codespace and on the idbpuilder k8s cluster at that same registry/repo/imagename:tag location."),(0,i.kt)("h4",{id:"example-mirroring-alpine-image"},"Example mirroring Alpine image"),(0,i.kt)("p",null,"So to be clear. On your local machine you have to tag your images appropriately like so:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker tag alpine:latest cnoe.localtest.me:8443/gitea/giteaadmin/alpine:latest\n")),(0,i.kt)("p",null,"Then you can push once your port-forwarding is working:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker push cnoe.localtest.me:8443/gitea/giteaadmin/alpine:latest\nThe push refers to repository [cnoe.localtest.me:8443/gitea/giteaadmin/alpine]\n3e01818d79cd: Layer already exists \nlatest: digest: sha256:fa7042902b0e812e73bbee26a6918a6138ccf6d7ecf1746e1488c0bd76cf1f34 size: 527\n")),(0,i.kt)("p",null,"Then on the cli inside your codespace you can pull it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull cnoe.localtest.me:8443/gitea/giteaadmin/alpine:latest\nlatest: Pulling from gitea/giteaadmin/alpine\nDigest: sha256:fa7042902b0e812e73bbee26a6918a6138ccf6d7ecf1746e1488c0bd76cf1f34\nStatus: Image is up to date for cnoe.localtest.me:8443/gitea/giteaadmin/alpine:latest\ncnoe.localtest.me:8443/gitea/giteaadmin/alpine:latest\n")),(0,i.kt)("p",null,"And when you run an image in your idpbuilder k8s cluster just make sure to reference it at the same location:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: alpine-from-local-registry\nspec:\n  containers:\n  - name: alpine-from-local-registry\n    image: cnoe.localtest.me:8443/gitea/giteaadmin/alpine:latest\n  restartPolicy: Never\n"))))}d.isMDXComponent=!0},7803:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/codespaces-create-8408d32852051c5e4cbad51cde41dc4c.png"}}]);