<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference-implementation/aws/docs/installation_with_idpbuilder" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Using IDPBuilder (Optional) | CNOE</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cnoe-io.github.io/docs/reference-implementation/aws/docs/installation_with_idpbuilder"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Using IDPBuilder (Optional) | CNOE"><meta data-rh="true" name="description" content="[!WARNING]"><meta data-rh="true" property="og:description" content="[!WARNING]"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cnoe-io.github.io/docs/reference-implementation/aws/docs/installation_with_idpbuilder"><link data-rh="true" rel="alternate" href="https://cnoe-io.github.io/docs/reference-implementation/aws/docs/installation_with_idpbuilder" hreflang="en"><link data-rh="true" rel="alternate" href="https://cnoe-io.github.io/docs/reference-implementation/aws/docs/installation_with_idpbuilder" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Setup IDP on AWS","item":"https://cnoe-io.github.io/docs/reference-implementation/aws/"},{"@type":"ListItem","position":2,"name":"Using IDPBuilder (Optional)","item":"https://cnoe-io.github.io/docs/reference-implementation/aws/docs/installation_with_idpbuilder"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CNOE RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CNOE Atom Feed">







<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="/assets/css/styles.9e0168f8.css">
<script src="/assets/js/runtime~main.3b14b417.js" defer="defer"></script>
<script src="/assets/js/main.51c6886a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="CNOE Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="CNOE Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/overview/cnoe">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://calendar.google.com/calendar/u/0/embed?src=064a2adfce866ccb02e61663a09f99147f22f06374e7a8994066bdc81e066986@group.calendar.google.com&amp;ctz=America/Los_Angeles" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar--calendar-link" aria-label="Community Calendar"></a><a href="https://cloud-native.slack.com/archives/C05TN9WFN5S" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar--slack-link" aria-label="Slack Channel"></a><a href="https://github.com/cnoe-io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar--github-link" aria-label="GitHub Repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/overview/cnoe">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/reference-implementation/local">IDP Reference Implementation</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/reference-implementation/local">Setup IDP on Local Machine</a><button aria-label="Expand sidebar category &#x27;Setup IDP on Local Machine&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/reference-implementation/aws">Setup IDP on AWS</a><button aria-label="Collapse sidebar category &#x27;Setup IDP on AWS&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference-implementation/aws/docs/installation_flow">Installation Flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference-implementation/aws/docs/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/reference-implementation/aws/docs/installation_with_idpbuilder">Using IDPBuilder (Optional)</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/idpbuilder">IDPBuilder</a><button aria-label="Expand sidebar category &#x27;IDPBuilder&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/tutorials/idpbuilder/idpbuilder-stack">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/contributing/aws-ref-impl-CONTRIBUTING">Contributing</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">IDP Reference Implementation</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/reference-implementation/aws"><span>Setup IDP on AWS</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Using IDPBuilder (Optional)</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This installation method is currently experimental and might not support all installation options as the primary method but is a good method to test deploying a new target cluster from a kind cluster for testing purposes!</p></div></div>
<header><h1>Installation using IDPBuilder</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation-flow-diagram">Installation Flow Diagram<a href="#installation-flow-diagram" class="hash-link" aria-label="Direct link to Installation Flow Diagram" title="Direct link to Installation Flow Diagram">​</a></h2>
<p>This diagram illustrates the high-level installation flow for the CNOE AWS Reference Implementation using <strong><code>idpbuilder</code></strong>. It shows how the <strong><code>idpbuilder</code></strong> and local environment interact with AWS resources to deploy and configure the platform on an EKS cluster.</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting Started<a href="#getting-started" class="hash-link" aria-label="Direct link to Getting Started" title="Direct link to Getting Started">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The installation requires AWS credentials to access the EKS cluster to deploy kubernetes resources. Therefore, the installation steps can be executed on local machine or on an EC2 instance with IAM instance role. If using local machine, please use <a href="https://github.com/99designs/aws-vault" target="_blank" rel="noopener noreferrer"><code>aws-vault</code></a> command to run local EC2 credentials server. Find more information about this requirement in <a href="/docs/reference-implementation/aws/docs/docs/installation_flow.md">installation flow</a> document.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-️-create-eks-cluster">Step 1. ☸️ Create EKS Cluster<a href="#step-1-️-create-eks-cluster" class="hash-link" aria-label="Direct link to Step 1. ☸️ Create EKS Cluster" title="Direct link to Step 1. ☸️ Create EKS Cluster">​</a></h3>
<p>The reference implementation can be installed on new EKS cluster which can be created with following tools:</p>
<ul>
<li><strong>eksctl</strong>: Follow the <a href="/docs/reference-implementation/aws/docs/cluster/eksctl">instructions</a></li>
<li><strong>terraform</strong>: Follow the <a href="/docs/reference-implementation/aws/docs/cluster/terraform">instructions</a></li>
</ul>
<p>This will create all the pre-requisite AWS Resources required for the reference implementation. Which includes:</p>
<ul>
<li>EKS cluster with Auto Mode or Without Auto Mode (Managed Node Group with 4 nodes)</li>
<li>Pod Identity Associations for following Addons:</li>
</ul>
<table><thead><tr><th>Name</th><th>Namespace</th><th>Service Account Name</th><th>Permissions</th></tr></thead><tbody><tr><td>Crossplane</td><td>crossplane-system</td><td>provider-aws</td><td>Admin Permissions but with <a href="/docs/reference-implementation/aws/docs/cluster/iam-policies/crossplane-permissions-boundry.json">permission boundary</a></td></tr><tr><td>External Secrets</td><td>external-secrets</td><td>external-secrets</td><td><a href="https://external-secrets.io/latest/provider/aws-secrets-manager/#iam-policy" target="_blank" rel="noopener noreferrer">Permissions</a></td></tr><tr><td>External DNS</td><td>external-dns</td><td>external-dns</td><td><a href="https://kubernetes-sigs.github.io/external-dns/latest/docs/tutorials/aws/#iam-policy" target="_blank" rel="noopener noreferrer">Permissions</a></td></tr><tr><td>AWS Load Balancer Controller (When not using Auto Mode)</td><td>kube-system</td><td>aws-load-balancer-controller</td><td><a href="https://github.com/kubernetes-sigs/aws-load-balancer-controller/blob/main/docs/install/iam_policy.json" target="_blank" rel="noopener noreferrer">Permissions</a></td></tr><tr><td>AWS EBS CSI Controller (When not using Auto Mode)</td><td>kube-system</td><td>ebs-csi-controller-sa</td><td><a href="https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AmazonEBSCSIDriverPolicy.html" target="_blank" rel="noopener noreferrer">Permissions</a></td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><strong>Using Existing EKS Cluster</strong></p><p>The reference implementation can be installed on existing EKS Cluster only if above pre-requisites are completed.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2--create-github-organization">Step 2. 🏢 Create GitHub Organization<a href="#step-2--create-github-organization" class="hash-link" aria-label="Direct link to Step 2. 🏢 Create GitHub Organization" title="Direct link to Step 2. 🏢 Create GitHub Organization">​</a></h3>
<p>Backstage and Argo CD in this reference implementation are integrated with GitHub. Therefore, a GitHub Organization should be created in order to create GitHub Apps for these integrations. Follow the instructions in <a href="https://docs.github.com/en/organizations/collaborating-with-groups-in-organizations/creating-a-new-organization-from-scratch" target="_blank" rel="noopener noreferrer">GitHub documentation</a> to create new organization.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3--fork-the-repository">Step 3. 🍴 Fork the Repository<a href="#step-3--fork-the-repository" class="hash-link" aria-label="Direct link to Step 3. 🍴 Fork the Repository" title="Direct link to Step 3. 🍴 Fork the Repository">​</a></h3>
<p>Once the organization is created, fork this repository to the new GitHub Organization by following instructions in <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/working-with-forks/fork-a-repo" target="_blank" rel="noopener noreferrer">GitHub documentation</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4--create-github-apps">Step 4. 💻 Create GitHub Apps<a href="#step-4--create-github-apps" class="hash-link" aria-label="Direct link to Step 4. 💻 Create GitHub Apps" title="Direct link to Step 4. 💻 Create GitHub Apps">​</a></h3>
<p>There are two ways to create GitHub App. You can use the Backstage CLI <code>npx @backstage/cli create-github-app &lt;github-org&gt;</code> as per instructions in <a href="https://backstage.io/docs/integrations/github/github-apps/#using-the-cli-public-github-only" target="_blank" rel="noopener noreferrer">Backstage documentation</a>, or create it manually per these instructions in <a href="https://backstage.io/docs/integrations/github/github-apps" target="_blank" rel="noopener noreferrer">GitHub documentation</a>.</p>
<p>Create following apps and store it in corresponding file path.</p>
<table><thead><tr><th>App Name</th><th>Purpose</th><th>Required Permissions</th><th>File Path</th><th>Expected Content</th></tr></thead><tbody><tr><td>Backstage</td><td>Used for automatically importing Backstage configuration such as Organization information, templates and creating new repositories for developer applications.</td><td>For All Repositories - Read access to members, metadata, and organization administration - Read and write access to administration and code</td><td><strong><code>private/backstage-github.yaml</code></strong></td><td><img decoding="async" loading="lazy" alt="backstage-github-app" src="/assets/images/backstage-github-app-e35214f17c03afc45063f32d47b84f95.png" width="858" height="330" class="img_ev3q"></td></tr><tr><td>Argo CD</td><td>Used for deploying resources to cluster specified by Argo CD applications.</td><td>For All Repositories - Read access to checks, code, members, and metadata</td><td><strong><code>private/argocd-github.yaml</code></strong></td><td><img decoding="async" loading="lazy" alt="argocd-github-app" src="/assets/images/argocd-github-app-8d7bddca9308000eca00685a458b84aa.png" width="822" height="272" class="img_ev3q"></td></tr></tbody></table>
<p>Argo CD requires <code>url</code> and <code>installationId</code> of the GitHub app. The <code>url</code> is the GitHub URL of the organization. The <code>installationId</code> can be captured by navigating to the app installation page with URL <code>https://github.com/organizations/&lt;Organization-name&gt;/settings/installations/&lt;ID&gt;</code>. You can find more information <a href="https://stackoverflow.com/questions/74462420/where-can-we-find-github-apps-installation-id" target="_blank" rel="noopener noreferrer">on this page</a>.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>If the app is created using backstage CLI, it creates files in current working directory. These files contains credentials. Handle it with care. It is recommended to remove these files after copying the content over to files in <code>private</code> directory</strong></p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The rest of the installation process assumes the GitHub apps credentials are available in <code>private/backstage-github.yaml</code> and <code>private/argocd-github.yaml</code></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-️-prepare-environment-for-installation">Step 5. ⚙️ Prepare Environment for Installation<a href="#step-5-️-prepare-environment-for-installation" class="hash-link" aria-label="Direct link to Step 5. ⚙️ Prepare Environment for Installation" title="Direct link to Step 5. ⚙️ Prepare Environment for Installation">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="-install-binaries">📦 Install Binaries<a href="#-install-binaries" class="hash-link" aria-label="Direct link to 📦 Install Binaries" title="Direct link to 📦 Install Binaries">​</a></h4>
<p>The installation requires following binaries in the local environment:</p>
<ul>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" target="_blank" rel="noopener noreferrer"><strong>AWS CLI</strong></a></li>
<li><a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreferrer"><strong>Docker</strong></a></li>
<li><a href="https://mikefarah.gitbook.io/yq/v3.x" target="_blank" rel="noopener noreferrer"><strong>yq</strong></a></li>
<li><a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer"><strong>helm</strong></a> <em>(Required only if using plain shell script for installation)</em></li>
<li><a href="https://github.com/cnoe-io/idpbuilder" target="_blank" rel="noopener noreferrer"><strong>IDPBuilder</strong></a> <em>(Required only if using ipdbuilder for installation)</em></li>
<li><a href="https://github.com/99designs/aws-vault?tab=readme-ov-file#installing" target="_blank" rel="noopener noreferrer"><strong>AWS Vault</strong></a> <em>(Required only for local machine installation)</em></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="-configure-aws-credentials">🔐 Configure AWS Credentials<a href="#-configure-aws-credentials" class="hash-link" aria-label="Direct link to 🔐 Configure AWS Credentials" title="Direct link to 🔐 Configure AWS Credentials">​</a></h4>
<p>If the installation steps are being executed on EC2 instance, just ensure that the EC2 IAM instance role has permissions to access EKS cluster. No other configuration is required in this case.</p>
<p>If the steps are being executed on a laptop/desktop, follow below steps:</p>
<ol>
<li>
<p>Configure the AWS CLI with credentials of an IAM role which has access to the EKS cluster. Follow instructions in <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-quickstart.html#getting-started-quickstart-new" target="_blank" rel="noopener noreferrer">AWS documentation</a> to configure AWS CLI.</p>
</li>
<li>
<p>Once AWS CLI is configured, install and start the EC2 credentials server.</p>
<div class="terminal_w2Kt"><div class="terminalHeader_Kk1r"><div class="terminalControls_X6oT"><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span></div><button class="copyButton_H_xL" aria-label="Copy all commands" data-copied="false"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><div class="terminalBody_tZ9P"><pre class="enhancedPre_UwTO"><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK">aws-vault exec &lt;AWS_PROFILE&gt; --ec2-server</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div></pre></div></div>
</li>
<li>
<p>Verify that the EC2 credentials server is started.</p>
<div class="terminal_w2Kt"><div class="terminalHeader_Kk1r"><div class="terminalControls_X6oT"><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span></div><button class="copyButton_H_xL" aria-label="Copy all commands" data-copied="false"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><div class="terminalBody_tZ9P"><pre class="enhancedPre_UwTO"><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK">curl -s http://169.254.169.254/latest/meta-data/iam/security-credentials/local-credentials</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div></pre></div></div>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="️-configure-reference-implementation">⚙️ Configure Reference Implementation<a href="#️-configure-reference-implementation" class="hash-link" aria-label="Direct link to ⚙️ Configure Reference Implementation" title="Direct link to ⚙️ Configure Reference Implementation">​</a></h4>
<p>The reference implementation uses <strong><code>config.yaml</code></strong> file in the repository root directory to pass values. Refer to following table and update all the values appropriately. All the values are required.</p>
<table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th></tr></thead><tbody><tr><td><code>repo.url</code></td><td>GitHub URL of the fork in Github Org</td><td>string</td></tr><tr><td><code>repo.revision</code></td><td>Branch or Tag which should be used for Argo CD Apps</td><td>string</td></tr><tr><td><code>repo.basepath</code></td><td>Directory in which configuration of addons is stored</td><td>string</td></tr><tr><td><code>cluster_name</code></td><td>Name of the EKS cluster for reference implementation   <strong>(The name should satisfy criteria of a valid <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/names/" target="_blank" rel="noopener noreferrer">kubernetes resource name</a>)</strong></td><td>string</td></tr><tr><td><code>auto_mode</code></td><td>Set to &quot;true&quot; if EKS cluster is Auto Mode, otherwise &quot;false&quot;</td><td>string</td></tr><tr><td><code>region</code></td><td>AWS Region of the EKS cluster and config secret</td><td>string</td></tr><tr><td><code>domain</code></td><td>Base Domain name for exposing services <strong>(This should be base domain or sub domain of the Route53 Hosted Zone)</strong></td><td>string</td></tr><tr><td><code>route53_hosted_zone_id</code></td><td>Route53 hosted zone ID for configuring external-dns</td><td>string</td></tr><tr><td><code>path_routing</code></td><td>Enable path routing (&quot;true&quot;) vs domain-based routing (&quot;false&quot;)</td><td>string</td></tr><tr><td><code>tags</code></td><td>Arbitrary key-value pairs for AWS resource tagging</td><td>object</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="-create-secrets-in-aws-secret-manager">🔒 Create Secrets in AWS Secret Manager<a href="#-create-secrets-in-aws-secret-manager" class="hash-link" aria-label="Direct link to 🔒 Create Secrets in AWS Secret Manager" title="Direct link to 🔒 Create Secrets in AWS Secret Manager">​</a></h4>
<p>The values required for the installation to work are stored in AWS Secret Manager in two secrets:</p>
<ol>
<li><strong>cnoe-ref-impl/config:</strong> Stores values from <strong><code>config.yaml</code></strong> in JSON</li>
<li><strong>cnoe-ref-impl/github-app:</strong> Stores GitHub App credentials with file name as key and content of the file as value from <strong>private</strong> directory.</li>
</ol>
<p>Run below command to create new secrets or update the existing secrets if already exists.</p>
<div class="terminal_w2Kt"><div class="terminalHeader_Kk1r"><div class="terminalControls_X6oT"><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span></div><button class="copyButton_H_xL" aria-label="Copy all commands" data-copied="false"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><div class="terminalBody_tZ9P"><pre class="enhancedPre_UwTO"><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK">./scripts/create-config-secrets.sh</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>DO NOT</strong> move to next steps without completing all the instructions in this step</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-6--installation">Step 6. 🚀 Installation<a href="#step-6--installation" class="hash-link" aria-label="Direct link to Step 6. 🚀 Installation" title="Direct link to Step 6. 🚀 Installation">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="️-start-the-installation-process">▶️ Start the Installation Process<a href="#️-start-the-installation-process" class="hash-link" aria-label="Direct link to ▶️ Start the Installation Process" title="Direct link to ▶️ Start the Installation Process">​</a></h4>
<p>The installation can be done using plain shell script or <code>idpbuilder</code>. All the addons are installed as Argo CD apps. When using bash script, Argo CD and External Secret Operator are installed on EKS cluster as helm chart. When installing with <code>idpbuilder</code>, the Argo CD in <code>idpbuilder</code> is used install these initial addons. Once Argo CD on EKS is up, other addons are installed through it and finally the Argo CD on EKS also manages itself. Check out more details about the <a href="/docs/reference-implementation/aws/docs/docs/installation_flow.md">installation flow</a>.</p>
<ul>
<li>
<p><strong>Install using script:</strong></p>
<div class="terminal_w2Kt"><div class="terminalHeader_Kk1r"><div class="terminalControls_X6oT"><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span></div><button class="copyButton_H_xL" aria-label="Copy all commands" data-copied="false"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><div class="terminalBody_tZ9P"><pre class="enhancedPre_UwTO"><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK">./scripts/install.sh</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div></pre></div></div>
</li>
<li>
<p><strong>Install using <code>idpbuilder</code>:</strong></p>
<div class="terminal_w2Kt"><div class="terminalHeader_Kk1r"><div class="terminalControls_X6oT"><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span></div><button class="copyButton_H_xL" aria-label="Copy all commands" data-copied="false"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><div class="terminalBody_tZ9P"><pre class="enhancedPre_UwTO"><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK">./scripts/install-using-idpbuilder.sh</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div></pre></div></div>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="-monitor-installation-process">📊 Monitor Installation Process<a href="#-monitor-installation-process" class="hash-link" aria-label="Direct link to 📊 Monitor Installation Process" title="Direct link to 📊 Monitor Installation Process">​</a></h4>
<p>The installation script will continue to run until all the addon Argo CD apps are healthy. To monitor the process, use below instructions to access Argo CD instances. <em>(If using EC2 instance, make sure the port-forward from EC2 to local machine is set up)</em></p>
<ul>
<li>
<p><strong><code>idpbuilder</code> Argo CD:</strong> <code>idpbuilder</code> exposes its Argo CD instance at <code>https://cnoe.localtest.me:8443/argocd</code> which can be accessed through browser.</p>
</li>
<li>
<p><strong>EKS Argo CD:</strong> Start the kubernetes port-forward session for Argo CD service and access the Argo CD UI in browser. In Argo CD UI, monitor the health of all Argo CD Apps</p>
<div class="terminal_w2Kt"><div class="terminalHeader_Kk1r"><div class="terminalControls_X6oT"><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span></div><button class="copyButton_H_xL" aria-label="Copy all commands" data-copied="false"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><div class="terminalBody_tZ9P"><pre class="enhancedPre_UwTO"><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK">kubectl port-forward -n argocd svc/argocd-server 8080:80</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div></pre></div></div>
</li>
</ul>
<p>Depending upon the configuration, Argo CD will be accessible at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080</a> or <a href="http://localhost:8080/argocd" target="_blank" rel="noopener noreferrer">http://localhost:8080/argocd</a>.</p>
<p>Switch between the kubernetes context of idpbuilder or EKS and retrieve the credentials for Argo CD can be retrieved with following command:</p>
<div class="terminal_w2Kt"><div class="terminalHeader_Kk1r"><div class="terminalControls_X6oT"><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span></div><button class="copyButton_H_xL" aria-label="Copy all commands" data-copied="false"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><div class="terminalBody_tZ9P"><pre class="enhancedPre_UwTO"><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK">kubectl get secrets -n argocd argocd-initial-admin-secret -oyaml | yq &#x27;.data.password&#x27; | base64 -d</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="comment_cniX"># OR</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK">idpbuilder get secrets -p argocd -o yaml</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-7--accessing-the-platform">Step 7. 🌐 Accessing the Platform<a href="#step-7--accessing-the-platform" class="hash-link" aria-label="Direct link to Step 7. 🌐 Accessing the Platform" title="Direct link to Step 7. 🌐 Accessing the Platform">​</a></h3>
<p>The addons are exposed using the base domain configured in <a href="#%EF%B8%8F-configure-reference-implementation">Step 5</a>. The URL depends on the setting for <code>path_routing</code>. Refer to following table for URLs:</p>
<table><thead><tr><th>App Name</th><th>URL (w/ Path Routing)</th><th>URL (w/o Path Routing)</th></tr></thead><tbody><tr><td>Backstage</td><td><code>https://[domain]</code></td><td><code>https://backstage.[domain]</code></td></tr><tr><td>Argo CD</td><td><code>https://[domain]/argocd</code></td><td><code>https://argocd.[domain]</code></td></tr><tr><td>Argo Workflows</td><td><code>https://[domain]/argo-workflows</code></td><td><code>https://argo-workflows.[domain]</code></td></tr></tbody></table>
<p>All the addons are configured with Keycloak SSO USER1 and the user password for it can be retrieved using following command:</p>
<div class="terminal_w2Kt"><div class="terminalHeader_Kk1r"><div class="terminalControls_X6oT"><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span><span class="terminalButton__Yhu"></span></div><button class="copyButton_H_xL" aria-label="Copy all commands" data-copied="false"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><div class="terminalBody_tZ9P"><pre class="enhancedPre_UwTO"><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK">kubectl get secrets -n keycloak keycloak-config -o go-template=&#x27;{{range $k,$v := .data}}{{printf &quot;%s: &quot; $k}}{{if not $v}}{{$v}}{{else}}{{$v | base64decode}}{{end}}{{&quot;\n&quot;}}{{end}}&#x27;</div></div></div><div class="commandLine__eue"><div class="" style="white-space:pre-wrap"><div class="text_hPwK"></div></div></div></pre></div></div>
<p>Once, all the Argo CD apps on EKS cluster are reporting healthy status, try out <a href="/docs/reference-implementation/aws/examples">examples</a> to create new application through Backstage.
For troubleshooting, refer to the <a href="/docs/reference-implementation/aws/docs/docs/troubleshooting.md">troubleshooting guide</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cleanup">Cleanup<a href="#cleanup" class="hash-link" aria-label="Direct link to Cleanup" title="Direct link to Cleanup">​</a></h2>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Before proceeding with the cleanup, ensure any Kubernetes resource created outside of the installation process such as Argo CD Apps, deployments, volume etc. are deleted.</p></div></div>
<p>Run following command to remove all the addons created by this installation:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./scripts/uninstall.sh</span><br></span></code></pre></div></div>
<p>This script will only remove resources other than CRDs from the EKS cluster so that the same cluster can used for re-installation which is useful during development. To remove CRDs, use following command:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./scripts/cleanup-crds.sh</span><br></span></code></pre></div></div>
<h1>Installation Flow</h1>
<p>This document describes the installation flow for the CNOE AWS Reference Implementation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>The CNOE AWS Reference Implementation uses a GitOps approach to deploy and manage addons on an EKS cluster. The installation process uses <code>helm</code> to bootstrap the EKS cluster with Argo CD and other addons. Detailed installation sequence is described below.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation-sequence">Installation Sequence<a href="#installation-sequence" class="hash-link" aria-label="Direct link to Installation Sequence" title="Direct link to Installation Sequence">​</a></h2>
<ol>
<li>
<p><strong>Configuration Setup</strong>:</p>
<ul>
<li>The <code>config.yaml</code> file is used to configure the installation</li>
<li>AWS Secrets Manager secrets are created to store configuration and GitHub App credentials using <code>create-config-secrets.sh</code> script</li>
</ul>
</li>
<li>
<p><strong>Local Environment Preparation</strong>:</p>
<ul>
<li>Using plain shell script:<!-- -->
<ul>
<li><code>install.sh</code> script reads the <code>config.yaml</code> and based on the specified cluster name, performs helm installation on EKS cluster.</li>
</ul>
</li>
<li>Using idpbuilder:<!-- -->
<ul>
<li><code>install-using-idpbuilder.sh</code> script reads the <code>config.yaml</code> and based on the specified cluster name, builds a Argo CD cluster secret from eks kubeconfig.</li>
<li><code>idpbuilder</code> creates a local Kind cluster with Argo CD, Gitea and Argo CD cluster secret for EKS cluster.</li>
<li>This local environment serves as a bootstrap mechanism for the remote EKS cluster using Argo CD in Kind cluster.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>EKS Cluster Bootstrap</strong>:</p>
<ul>
<li>Using plain shell script:<!-- -->
<ul>
<li>The script performs helm installation of Argo CD and External Secret Operator on the EKS cluster. It will use the temporary kubeconfig for accessing EKS cluster.</li>
</ul>
</li>
<li>Using idpbuilder:<!-- -->
<ul>
<li><code>idpbuilder</code> applies Argo CD applications from the root of <code>packages</code> directory to the local Kind cluster, mainly <code>boostrap.yaml</code> and <code>addons-appset.yaml</code>.</li>
<li>Argo CD in the Kind cluster installs Argo CD and External Secret Operator on the EKS cluster. It will use AWS credentials to authenticate with EKS cluster.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Addons Deployment</strong>:</p>
<ul>
<li>The <code>addons-appset.yaml</code> creates an ApplicationSet in the EKS cluster&#x27;s Argo CD</li>
<li>This ApplicationSet creates individual Argo CD applicationSet for each addon using <a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Generators-Cluster/" target="_blank" rel="noopener noreferrer">cluster generator</a>.</li>
<li>Addons are installed in a specific order to handle dependencies</li>
</ul>
</li>
<li>
<p><strong>Addon Configuration</strong>:</p>
<ul>
<li>Addons are configured using helm values</li>
<li>Static values are stored <code>packages/&lt;addon-name&gt;/values.yaml</code></li>
<li>Dynamic values from Argo CD cluster secret labels/annotations which depend on configuration from AWS Secrets Manager.</li>
</ul>
</li>
<li>
<p><strong>Monitoring and Verification</strong>:</p>
<ul>
<li>The installation script waits for all Argo CD applications to become healthy</li>
<li>Addons can be accessed through the configured domain based on path routing settings</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uninstallation-process">Uninstallation Process<a href="#uninstallation-process" class="hash-link" aria-label="Direct link to Uninstallation Process" title="Direct link to Uninstallation Process">​</a></h2>
<p>The uninstallation process follows these steps:</p>
<ol>
<li>
<p><strong>Remove idpbuilder Local Cluster</strong>:</p>
<ul>
<li>The local Kind cluster created by idpbuilder is deleted</li>
</ul>
</li>
<li>
<p><strong>Remove Addons</strong>:</p>
<ul>
<li>Addons are removed in a specific order to handle dependencies</li>
<li>ApplicationSets are deleted with orphan deletion policy</li>
<li>PVCs for stateful applications are cleaned up</li>
</ul>
</li>
<li>
<p><strong>CRD Cleanup (Optional)</strong>:</p>
<ul>
<li>Custom Resource Definitions can be cleaned up using the <code>cleanup-crds.sh</code> script</li>
<li>This is optional and useful when you want to completely remove all traces of the installation</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-components">Key Components<a href="#key-components" class="hash-link" aria-label="Direct link to Key Components" title="Direct link to Key Components">​</a></h2>
<ol>
<li><strong>helm</strong> <em>(if using <code>install.sh</code>)</em>: Bootstraps EKS cluster through helm chart installation.</li>
<li><strong>idpbuilder</strong> <em>(if using <code>install-using-idpbuilder.sh</code>)</em>: Creates a local Kind cluster with Argo CD and Gitea, which bootstraps the EKS cluster</li>
<li><strong>Argo CD</strong>: Manages the deployment of addons on the EKS cluster using GitOps</li>
<li><strong>External Secret Operator</strong>: Manages secrets from AWS Secrets Manager</li>
<li><strong>Addons</strong>: Various tools and services that make up the Internal Developer Platform</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="aws-resources">AWS Resources<a href="#aws-resources" class="hash-link" aria-label="Direct link to AWS Resources" title="Direct link to AWS Resources">​</a></h2>
<p>The installation relies on these AWS resources:</p>
<ol>
<li><strong>EKS Cluster</strong>: The Kubernetes cluster where the platform is deployed</li>
<li><strong>AWS Secrets Manager</strong>: Stores configuration and GitHub App credentials</li>
<li><strong>IAM Roles</strong>: For pod identity associations required by various addons</li>
<li><strong>Route53</strong>: For DNS management via External DNS</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/cnoe-io/reference-implementation-aws/blob/main/docs/installation_with_idpbuilder.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/reference-implementation/aws/docs/troubleshooting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Troubleshooting</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/idpbuilder"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">IDPBuilder</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation-flow-diagram" class="table-of-contents__link toc-highlight">Installation Flow Diagram</a></li><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting Started</a><ul><li><a href="#step-1-️-create-eks-cluster" class="table-of-contents__link toc-highlight">Step 1. ☸️ Create EKS Cluster</a></li><li><a href="#step-2--create-github-organization" class="table-of-contents__link toc-highlight">Step 2. 🏢 Create GitHub Organization</a></li><li><a href="#step-3--fork-the-repository" class="table-of-contents__link toc-highlight">Step 3. 🍴 Fork the Repository</a></li><li><a href="#step-4--create-github-apps" class="table-of-contents__link toc-highlight">Step 4. 💻 Create GitHub Apps</a></li><li><a href="#step-5-️-prepare-environment-for-installation" class="table-of-contents__link toc-highlight">Step 5. ⚙️ Prepare Environment for Installation</a></li><li><a href="#step-6--installation" class="table-of-contents__link toc-highlight">Step 6. 🚀 Installation</a></li><li><a href="#step-7--accessing-the-platform" class="table-of-contents__link toc-highlight">Step 7. 🌐 Accessing the Platform</a></li></ul></li><li><a href="#cleanup" class="table-of-contents__link toc-highlight">Cleanup</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#installation-sequence" class="table-of-contents__link toc-highlight">Installation Sequence</a></li><li><a href="#uninstallation-process" class="table-of-contents__link toc-highlight">Uninstallation Process</a></li><li><a href="#key-components" class="table-of-contents__link toc-highlight">Key Components</a></li><li><a href="#aws-resources" class="table-of-contents__link toc-highlight">AWS Resources</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">DOCS</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/overview/cnoe">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contribute">Contribute</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">SOCIAL</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cloud-native.slack.com/archives/C05TN9WFN5S" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://calendar.google.com/calendar/u/0/embed?src=064a2adfce866ccb02e61663a09f99147f22f06374e7a8994066bdc81e066986@group.calendar.google.com&amp;ctz=America/Los_Angeles" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Meeting Calendar<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">MORE</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/cnoe-io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 CNOE</div></div></div></footer></div>
</body>
</html>